webpackJsonp([15],{b5au:function(t,e){},rFKw:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("mvHQ"),i=a.n(n),l=a("pP4B"),s=a("SwQL"),o={name:"PlanInfo",data:function(){return{submiting:!1,id:this.$route.query.id,typ:null,mediaList:[],deviceList:[],allDevices:[],sourceList:[],videoBackup:null,audioBackup:null,planInfo:{id:null,name:null,iscycle:2,startDate:null,endDate:null,playBegin:null,playEnd:null,status:0,typ:null,notes:null,mediaids:null,deviceids:[]},indeterminate:!1,checkAll:!1,ruleValidate:{name:[{required:!0,message:"该项为必填项",trigger:"blur"}],startDate:[{required:!0,type:"date",message:"该项为必填项",trigger:"change"}],endDate:[{required:!0,type:"date",message:"该项为必填项",trigger:"change"}],typ:[{required:!0,trigger:"change",validator:function(t,e,a){""===e&&a("该项为必填项"),a([])}}],mediaids:[{required:!0,trigger:"change",validator:function(t,e,a){null===e&&a("该项为必填项"),a([])}}],deviceids:[{required:!0,type:"array",message:"该项为必选项",trigger:"change"}],playBegin:[{required:!0,type:"date",message:"该项为必填项",trigger:"change"}],playEnd:[{required:!0,type:"date",message:"该项为必填项",trigger:"change"}]}}},created:function(){null!==this.$route.query.id&&(this.getPlanInfo(),this.getMediaList(),this.getDeviceList()),this.getAllDevices()},methods:{handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){t?e.addPlanBySource():e.$Message.error("参数格式有误!")})},radiochange:function(t){this.planInfo.mediaids=t},handleCheckAll:function(){this.indeterminate?this.checkAll=!1:this.checkAll=!this.checkAll,this.indeterminate=!1,this.checkAll?this.planInfo.deviceids=this._allDevices:this.planInfo.deviceids=[]},checkAllGroupChange:function(t){t.length===this._allDevices.length?(this.indeterminate=!1,this.checkAll=!0):t.length>0?(this.indeterminate=!0,this.checkAll=!1):(this.indeterminate=!1,this.checkAll=!1)},handleReset:function(t){this.$router.push({path:"/lamp/broadcast-plan"})},dateChange:function(t,e){this.planInfo[e]=t},mediaTypeChange:function(){1===this.typ?(this.videoBackup=this.planInfo.mediaids,this.planInfo.mediaids=this.audioBackup):2===this.typ&&(this.audioBackup=this.planInfo.mediaids,this.planInfo.mediaids=this.videoBackup),this.getSourceList(this.typ)},getPlanInfo:function(){var t=this;Object(l.a)({url:"plan/info",method:"POST",data:{id:this.id}}).then(function(e){200===e.code&&(t.planInfo=e.data)})},getMediaList:function(){var t=this;Object(l.a)({url:"plan/medialist",method:"POST",data:{id:this.id}}).then(function(e){200===e.code&&(t.planInfo.mediaids=e.data[0].id,1===e.data[0].typ?t.audioBackup=e.data[0].id:t.videoBackup=e.data[0].id)})},getDeviceList:function(){var t=this;Object(l.a)({url:"plan/deviceslist",method:"POST",data:{id:this.id}}).then(function(e){if(200===e.code){t.deviceList=e.data;var a=e.data.map(function(t){return t.id});t.planInfo.deviceids=a}})},getSourceList:function(t){var e=this;Object(l.a)({url:"media/list",method:"POST",data:{typ:t,is_page:1}}).then(function(t){200===t.code&&(e.sourceList=t.data.content)})},getAllDevices:function(){var t=this;Object(l.a)({url:"devices/list",method:"POST",data:{is_page:1,typ:2}}).then(function(e){200===e.code&&(t.allDevices=e.data.content)})},addordeletedevices:function(){var t=this;Object(l.a)({url:"plan/addordeletedevices",method:"POST",data:{id:this.id,ids:[]}}).then(function(e){200===e.code&&t.$Message.success("操作成功")})},addPlanBySource:function(){var t=this;this.submiting=!0;var e={name:this.planInfo.name,iscycle:this.planInfo.iscycle,startDate:Object(s.a)(this.planInfo.startDate),endDate:Object(s.a)(this.planInfo.endDate),playBegin:Object(s.b)(this.planInfo.playBegin),playEnd:Object(s.b)(this.planInfo.playEnd),status:this.planInfo.status,typ:this.planInfo.typ,notes:this.planInfo.notes,mediaids:this.planInfo.mediaids,deviceids:String(this.planInfo.deviceids)};null!==this.$route.query.id&&(e.id=this.id),Object(l.a)({url:"plan/addplanbysource",method:"POST",data:e}).then(function(e){t.submiting=!1,200===e.code?(t.$Message.success("完成!"),t.backupInfo=JSON.parse(i()(t.planInfo)),t.$router.push({path:"/lamp/broadcast-plan"})):400===e.code&&t.$Message.error("参数填写不完整")})}},computed:{_allDevices:function(){return this.allDevices.map(function(t){return t.id})},title:function(){return null!==this.$route.query.id?"编辑播报计划":"添加播报计划"}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"a"}},[a("Tag",{staticStyle:{"margin-bottom":"10px"},attrs:{checkable:"",color:"green"}},[t._v(t._s(t.title))]),t._v(" "),null!==t.$route.query.id?a("div"):t._e(),t._v(" "),a("Row",{attrs:{gutter:8}},[a("Form",{ref:"planInfo",attrs:{model:t.planInfo,rules:t.ruleValidate,"label-width":80}},[a("Col",{attrs:{span:8}},[a("Card",{staticStyle:{height:"600px"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"information-circled"}}),t._v("\n            基本信息\n        ")],1),t._v(" "),a("FormItem",{attrs:{label:"计划名称",prop:"name"}},[a("Input",{attrs:{placeholder:"计划名称"},model:{value:t.planInfo.name,callback:function(e){t.$set(t.planInfo,"name",e)},expression:"planInfo.name"}})],1),t._v(" "),a("FormItem",{attrs:{label:"开放日期"}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{prop:"startDate"}},[a("DatePicker",{attrs:{type:"datetime",placeholder:"开始日期",format:"yyyy-MM-dd HH:mm:ss"},on:{"on-change":function(e){t.dateChange(e,"startDate")}},model:{value:t.planInfo.startDate,callback:function(e){t.$set(t.planInfo,"startDate",e)},expression:"planInfo.startDate"}})],1)],1),t._v(" "),a("Col",{staticStyle:{"text-align":"center"},attrs:{span:"2"}},[t._v("-")]),t._v(" "),a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{prop:"endDate"}},[a("DatePicker",{attrs:{type:"datetime",placeholder:"结束日期",format:"yyyy-MM-dd HH:mm:ss"},on:{"on-change":function(e){t.dateChange(e,"endDate")}},model:{value:t.planInfo.endDate,callback:function(e){t.$set(t.planInfo,"endDate",e)},expression:"planInfo.endDate"}})],1)],1)],1)],1),t._v(" "),a("FormItem",{attrs:{label:"开放时间"}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{prop:"playBegin"}},[a("TimePicker",{attrs:{type:"time",placeholder:"开始时间",format:"HH:mm:ss"},on:{"on-change":function(e){t.dateChange(e,"planBegin")}},model:{value:t.planInfo.playBegin,callback:function(e){t.$set(t.planInfo,"playBegin",e)},expression:"planInfo.playBegin"}})],1)],1),t._v(" "),a("Col",{staticStyle:{"text-align":"center"},attrs:{span:"2"}},[t._v("-")]),t._v(" "),a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{prop:"playEnd"}},[a("TimePicker",{attrs:{type:"time",placeholder:"结束时间",format:"HH:mm:ss"},on:{"on-change":function(e){t.dateChange(e,"planEnd")}},model:{value:t.planInfo.playEnd,callback:function(e){t.$set(t.planInfo,"playEnd",e)},expression:"planInfo.playEnd"}})],1)],1)],1)],1),t._v(" "),a("FormItem",{attrs:{label:"循环播放",prop:"iscycle"}},[a("i-switch",{attrs:{"true-value":1,"false-value":2},model:{value:t.planInfo.iscycle,callback:function(e){t.$set(t.planInfo,"iscycle",e)},expression:"planInfo.iscycle"}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("是")]),t._v(" "),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("否")])])],1),t._v(" "),a("FormItem",{attrs:{label:"播报类型",prop:"typ"}},[a("RadioGroup",{model:{value:t.planInfo.typ,callback:function(e){t.$set(t.planInfo,"typ",e)},expression:"planInfo.typ"}},[a("Radio",{attrs:{label:1}},[t._v("音频")]),t._v(" "),a("Radio",{attrs:{label:2}},[t._v("视频")])],1)],1),t._v(" "),a("FormItem",{attrs:{label:"状态",prop:"status"}},[a("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:t.planInfo.status,callback:function(e){t.$set(t.planInfo,"status",e)},expression:"planInfo.status"}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("开")]),t._v(" "),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("关")])])],1),t._v(" "),a("FormItem",{attrs:{label:"计划描述",prop:"notes"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"计划描述"},model:{value:t.planInfo.notes,callback:function(e){t.$set(t.planInfo,"notes",e)},expression:"planInfo.notes"}})],1)],1)],1),t._v(" "),a("Col",{attrs:{span:8}},[a("Card",{staticStyle:{height:"600px"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"information-circled"}}),t._v("\n            播报资源\n        ")],1),t._v(" "),a("RadioGroup",{on:{"on-change":t.mediaTypeChange},model:{value:t.typ,callback:function(e){t.typ=e},expression:"typ"}},[a("Radio",{attrs:{label:1}},[t._v("音频")]),t._v(" "),a("Radio",{attrs:{label:2}},[t._v("视频")])],1),t._v(" "),a("Card",{staticStyle:{"margin-top":"20px","max-height":"400px",overflow:"auto"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"ios-folder-outline"}}),t._v("\n              资源列表\n            ")],1),t._v(" "),a("div",[0===t.sourceList.length?a("div",[t._v("请先在上方选择资源类型")]):t._e(),t._v(" "),t.sourceList.length>0?[a("FormItem",{attrs:{prop:"mediaids",label:"媒体资源"}},[a("RadioGroup",{on:{"on-change":t.radiochange},model:{value:t.planInfo.mediaids,callback:function(e){t.$set(t.planInfo,"mediaids",e)},expression:"planInfo.mediaids"}},t._l(t.sourceList,function(e){return a("Radio",{key:e.id,attrs:{label:e.id}},[t._v(t._s(e.name))])}))],1)]:t._e(),t._v(" "),t.typ&&0===t.sourceList.length?[a("div",[t._v("\n                  无资源，请先通过FTP上传资源\n                ")])]:t._e()],2)])],1)],1),t._v(" "),a("Col",{attrs:{span:8}},[a("Card",{staticStyle:{height:"600px"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"information-circled"}}),t._v("\n            播报设备\n        ")],1),t._v(" "),0===t.deviceList.length?a("div"):t._e(),t._v(" "),[a("div",{staticStyle:{"border-bottom":"1px solid #e9e9e9","padding-bottom":"6px","margin-bottom":"6px",overflow:"auto","max-height":"450px"}},[a("Checkbox",{attrs:{indeterminate:t.indeterminate,value:t.checkAll},nativeOn:{click:function(e){e.preventDefault(),t.handleCheckAll(e)}}},[t._v("全选")])],1),t._v(" "),a("CheckboxGroup",{staticClass:"allevList",on:{"on-change":t.checkAllGroupChange},model:{value:t.planInfo.deviceids,callback:function(e){t.$set(t.planInfo,"deviceids",e)},expression:"planInfo.deviceids"}},t._l(t.allDevices,function(e){return a("Checkbox",{key:e.id,staticStyle:{display:"block"},attrs:{label:e.id}},[t._v(t._s(e.name))])}))]],2)],1),t._v(" "),a("Col",{staticStyle:{"text-align":"right","margin-top":"20px"},attrs:{offset:18,span:6}},[a("FormItem",[a("Button",{attrs:{type:"primary",loading:t.submiting},on:{click:function(e){t.handleSubmit("planInfo")}}},[t._v("提交")]),t._v(" "),a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:function(e){t.handleReset("planInfo")}}},[t._v("取消")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(o,r,!1,function(t){a("b5au")},null,null);e.default=c.exports}});