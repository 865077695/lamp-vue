webpackJsonp([14],{Pr3R:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("G0Ko"),d=e("CIu9"),r=e("7EUm"),i=e("pP4B"),s=e("O6e2"),n={name:"LampGroup",components:{MyForm:o.a,MyPage:d.a},data:function(){var t=this;return{tableLoading:!1,addModal:!1,adding:!1,lampGroupSearchItem:r.n,addLampGroupItem:r.e,addLampGroupFormRule:r.d,totalPage:null,addText:"添加分组",lampGroupSearchParams:{currentPage:1,streetId:this.$route.query.id},addLampGroupData:{streetId:this.$route.query.id,poles:[],notes:" ",timeOn:null,timeOff:null,name:null},lightGroupList:[],columns:[{title:"分组名称",key:"name"},{title:"开灯时间",key:"timeOn"},{title:"关灯时间",key:"timeOff"},{title:"备注",key:"notes"},{title:"修改人",key:"modifyName"},{title:"修改时间",key:"modifyTime"},{title:"操作",key:"action",width:200,render:function(a,e){return a("div",[a("Button",{props:{type:"primary",size:"small"},on:{click:function(){t.addText="编辑分组",Object(i.a)({url:"poleGroup/poleGroupsInfo",params:{id:e.row.id}}).then(function(a){200===a.code&&(t.addLampGroupData=a.data.lightGroups,t.addLampGroupData.poles=t.addLampGroupData.poles.map(function(t){return t.id}),t.addModal=!0)})}}},"编辑"),a("Poptip",{props:{confirm:!0,title:"您确定要删除这条数据吗?",transfer:!0},on:{"on-ok":function(){t.delete(e.row.id)}}},[a("Button",{style:{margin:"0 10px"},props:{type:"error",placement:"top",size:"small"}},"删除")])])}}]}},activated:function(){this.getlampGroupsList()},created:function(){var t=this;this.getlampGroupsList(),Object(i.a)({url:"/pole/polesList",method:"POST",data:{currentPage:1,pageSize:111111,streetId:this.$route.query.id}}).then(function(a){if(200===a.code){var e=[];a.data.polesList.map(function(t){e.push({label:t.name,value:t.id})}),t.addLampGroupItem[3].options=e,s.a.$emit("setPolesListOptions1",t.addLampGroupItem[3].options)}})},methods:{doValida:function(t){this.$refs[t].handleValida()},searchOk:function(){this.lampGroupSearchParams.currentPage=1,this.getlampGroupsList()},addOk:function(){var t=this;console.log(this.addText),this.adding=!0;var a="",e={};"添加分组"===this.addText?(console.log("新增"),a="poleGroup/poleGroupsAdd",this.addLampGroupData.poles=this.addLampGroupData.poles.map(function(t){return{id:t}}),e=this.addLampGroupData):"编辑分组"===this.addText&&(console.log("编辑"),a="poleGroup/poleGroupsEdit",e.name=this.addLampGroupData.name,e.id=this.addLampGroupData.id,e.timeOn=this.addLampGroupData.timeOn,e.timeOff=this.addLampGroupData.timeOff,e.notes=this.addLampGroupData.notes,e.streetId=this.addLampGroupData.streetId,e.poles=this.addLampGroupData.poles.map(function(t){return{id:t}})),console.log(a),Object(i.a)({url:a,method:"POST",data:e}).then(function(a){200===a.code&&(t.adding=!1,t.addModal=!1,t.$Message.success("成功"),t.addLampGroupData={streetId:t.$route.query.id},t.getlampGroupsList())})},add:function(){this.addModal=!0,this.addText="添加分组",this.addLampGroupData={streetId:this.$route.query.id,poles:[],notes:" ",timeOn:null,timeOff:null,name:null}},cancel:function(){this.addLampGroupData={streetId:this.$route.query.id},this.addModal=!1},pageChange:function(){this.getlampGroupsList()},getlampGroupsList:function(){var t=this;this.tableLoading=!0,Object(i.a)({url:"poleGroup/poleGroupsList",method:"POST",data:this.lampGroupSearchParams}).then(function(a){t.tableLoading=!1,200===a.code&&(t.lightGroupList=a.data.lightGroupList,t.totalPage=a.data.totalPage)})},getlampGroupInfo:function(){},delete:function(t){var a=this;Object(i.a)({url:"poleGroup/delete",method:"POST",data:{id:t}}).then(function(t){200===t.code&&(a.$Message.success("删除成功"),a.getlampGroupsList())})}}},p={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("p",{staticStyle:{"line-height":"38px","font-size":"16px"}},[t._v("街道："+t._s(t.$route.query.name))]),t._v(" "),e("div",{staticClass:"search"},[e("Button",{staticStyle:{height:"32px","margin-left":"10px"},attrs:{type:"success"},on:{click:t.add}},[t._v("添加分组")])],1),t._v(" "),e("Modal",{attrs:{width:"720"},model:{value:t.addModal,callback:function(a){t.addModal=a},expression:"addModal"}},[e("p",{attrs:{slot:"header"},slot:"header"},[e("span",[t._v(t._s(t.addText))])]),t._v(" "),e("div",{staticStyle:{"min-height":"300px",overflow:"auto"}},[e("my-form",{ref:"addForm",attrs:{formItems:t.addLampGroupItem,formData:t.addLampGroupData,formRule:t.addLampGroupFormRule},on:{validaok:t.addOk}})],1),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"primary",size:"large",loading:t.adding},on:{click:function(a){t.doValida("addForm")}}},[t._v("提交")]),t._v(" "),e("Button",{attrs:{type:"default",size:"large"},on:{click:t.cancel}},[t._v("取消")])],1)]),t._v(" "),e("Table",{staticClass:"table",attrs:{loading:t.tableLoading,border:"",columns:t.columns,data:t.lightGroupList}}),t._v(" "),e("my-page",{attrs:{_totalPage:t.totalPage,_currentPage:t.lampGroupSearchParams.currentPage},on:{pageChange:t.pageChange,"update:_currentPage":function(a){t.$set(t.lampGroupSearchParams,"currentPage",a)}}})],1)},staticRenderFns:[]};var l=e("VU/8")(n,p,!1,function(t){e("n9y/")},"data-v-293b8880",null);a.default=l.exports},"n9y/":function(t,a){}});