webpackJsonp([9],{bZ4l:function(t,a){},v0A7:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var d=e("Gu7T"),l=e.n(d),s=e("Dd8w"),i=e.n(s),n=e("G0Ko"),o=e("CIu9"),r=e("UMie"),u=e("SwQL"),c=e("7EUm"),m=e("pP4B"),p={name:"StreetAdmin",components:{MyForm:n.a,MyPage:o.a},data:function(){var t=this;return{tableLoading:!1,addModal:!1,adding:!1,lampListSearchItem:c.o,addLampItem:c.f,addLampFormRule:c.c,totalPage:null,addText:"添加灯杆",lampSearchParams:{name:null,currentPage:1,streetId:this.$route.query.id,status:null,poleSn:null},addLampData:{streetId:this.$route.query.id,poleSn:null,name:null,latitude:null,status:1,longitude:null},lampsList:[],columns:[{title:"灯杆编号",key:"poleSn"},{title:"灯杆名称",key:"name"},{title:"经度",key:"longitude",width:100},{title:"纬度",key:"latitude",width:100},{title:"灯杆状态",key:"status",render:function(t,a){return Object(u.c)(a.row.status,r.h)}},{title:"修改人",key:"modifyName"},{title:"修改时间",key:"modifyTime",width:160},{title:"操作",key:"action",width:230,render:function(a,e){var d=[a("Button",{props:{type:"primary",size:"small"},on:{click:function(){t.$router.push({path:"/device-admin",query:i()({},e.row,{streetName:t.$route.query.name})})}}},"设备管理")],s=[a("Button",{props:{type:"primary",size:"small"},on:{click:function(){t.addText="修改",t.addLampData=e.row,t.add()}}},"编辑"),a("Poptip",{props:{confirm:!0,title:"您确定要删除这条数据吗?",transfer:!0},on:{"on-ok":function(){t.delete(e.row.id)}}},[a("Button",{style:{margin:"0 10px"},props:{type:"error",placement:"top",size:"small"}},"删除")])];return"sys_admin"===t.roleType&&(d=[].concat(s,l()(d))),a("div",d)}}]}},created:function(){this.getlampsList()},activated:function(){this.getlampsList()},computed:{roleType:function(){return console.log(this.$store.state.roleCode),this.$store.state.roleCode}},methods:{doValida:function(t){this.$refs[t].handleValida()},searchOk:function(){this.lampSearchParams.currentPage=1,this.getlampsList()},addOk:function(){var t=this;this.adding=!0;var a="",e={};"添加灯杆"===this.addText?(a="pole/polesAdd",e=this.addLampData):"修改"===this.addText&&(a="pole/polesEdit",e.streetId=this.addLampData.streetId,e.id=this.addLampData.id,e.poleSn=this.addLampData.poleSn,e.name=this.addLampData.name,e.latitude=this.addLampData.latitude,e.status=this.addLampData.status,e.longitude=this.addLampData.longitude),Object(m.a)({url:a,method:"POST",data:e}).then(function(a){200===a.code&&(t.adding=!1,t.addModal=!1,t.$Message.success("成功"),t.addLampData={streetId:t.$route.query.id,poleSn:null,name:null,latitude:null,status:null,longitude:null},t.getlampsList())})},add:function(){this.addModal=!0},cancel:function(){this.addLampData={streetId:this.$route.query.id,poleSn:null,name:null,latitude:null,status:null,longitude:null},this.addModal=!1},pageChange:function(){this.getlampsList()},getlampsList:function(){var t=this;this.tableLoading=!0,Object(m.a)({url:"/pole/polesList",method:"POST",data:this.lampSearchParams}).then(function(a){t.tableLoading=!1,200===a.code&&(t.lampsList=a.data.polesList,t.totalPage=a.data.totalPage)})},delete:function(t){var a=this;Object(m.a)({url:"pole/delete",method:"POST",data:{id:t}}).then(function(t){200===t.code&&(a.$Message.success("删除成功"),a.getlampsList())})}}},h={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("p",{staticStyle:{"line-height":"38px","font-size":"16px"}},[t._v(t._s(t.$route.query.name))]),t._v(" "),e("div",{staticClass:"search"},[e("my-form",{ref:"searchForm",staticClass:"searchForm",attrs:{formItems:t.lampListSearchItem,formData:t.lampSearchParams},on:{validaok:t.searchOk}}),t._v(" "),e("Button",{staticStyle:{height:"32px"},attrs:{type:"primary"},on:{click:function(a){t.doValida("searchForm")}}},[t._v("搜索")]),t._v(" "),"addr_admin"!==t.roleType?e("Button",{staticStyle:{height:"32px","margin-left":"10px"},attrs:{type:"success"},on:{click:t.add}},[t._v("添加")]):t._e()],1),t._v(" "),e("Modal",{attrs:{width:"360"},model:{value:t.addModal,callback:function(a){t.addModal=a},expression:"addModal"}},[e("p",{attrs:{slot:"header"},slot:"header"},[e("span",[t._v(t._s(t.addText))])]),t._v(" "),e("div",{staticStyle:{height:"200px"}},[e("my-form",{ref:"addForm",attrs:{formItems:t.addLampItem,formData:t.addLampData,formRule:t.addLampFormRule},on:{validaok:t.addOk}})],1),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"primary",size:"large",loading:t.adding},on:{click:function(a){t.doValida("addForm")}}},[t._v("提交")]),t._v(" "),e("Button",{attrs:{type:"default",size:"large"},on:{click:t.cancel}},[t._v("取消")])],1)]),t._v(" "),e("Table",{staticClass:"table",attrs:{loading:t.tableLoading,border:"",columns:t.columns,data:t.lampsList}}),t._v(" "),e("my-page",{attrs:{_totalPage:t.totalPage,_currentPage:t.lampSearchParams.currentPage},on:{pageChange:t.pageChange,"update:_currentPage":function(a){t.$set(t.lampSearchParams,"currentPage",a)}}})],1)},staticRenderFns:[]};var g=e("VU/8")(p,h,!1,function(t){e("bZ4l")},"data-v-6458a3d0",null);a.default=g.exports}});