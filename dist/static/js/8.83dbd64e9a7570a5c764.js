webpackJsonp([8],{"4m1W":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=a("Gu7T"),n=a.n(d),i=a("G0Ko"),l=a("7EUm"),s=a("SwQL"),o=a("UMie"),r=a("pP4B"),u={name:"DeviceAdmin",components:{MyForm:i.a},data:function(){return{tableLoading:!1,addModal:!1,adding:!1,devSearchItem:l.m,addDevItem:l.b,addDevFormRule:l.a,addText:"添加设备",devSearchParams:{pole_id:this.$route.query.id,typ:null,name:null,status:null},addDevData:{pole_id:this.$route.query.id,typ:null,name:null,status:1,sn:null,volume:null,version:null,url:null},devList:[]}},created:function(){this.getdevList()},computed:{roleType:function(){return console.log(this.$store.state.roleCode),this.$store.state.roleCode},columns:function(){var t=this,e=[{title:"设备名称",key:"name"},{title:"设备编号",key:"sn"},{title:"设备类型",key:"typ",render:function(t,e){return Object(s.c)(e.row.typ,o.e.typeOptions)}},{title:"状态",key:"status",render:function(t,e){return Object(s.c)(e.row.status,o.e.statusOptions)}},{title:"设备版本",key:"version"}];return"sys_admin"===this.roleType&&(e=[].concat(n()(e),[{title:"操作",key:"action",width:200,render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small"},on:{click:function(){t.addText="编辑设备",t.addDevData=a.row,t.addModal=!0}}},"编辑"),e("Poptip",{props:{confirm:!0,title:"您确定要删除这条数据吗?",transfer:!0},on:{"on-ok":function(){Object(r.a)({url:"devices/delete",method:"POST",data:{ids:a.row.id}}).then(function(e){200===e.code&&t.getdevList()})}}},[e("Button",{style:{margin:"0 10px"},props:{type:"error",placement:"top",size:"small"}},"删除")])])}}])),e}},methods:{doValida:function(t){this.$refs[t].handleValida()},addOk:function(){var t=this;this.adding=!0;var e="",a={};"添加设备"===this.addText?(e="devices/add",a=this.addDevData):"编辑设备"===this.addText&&(e="devices/update",a.pole_id=this.addDevData.pole_id,a.typ=this.addDevData.typ,a.name=this.addDevData.name,a.sn=this.addDevData.sn,a.status=1,a.url=this.addDevData.url,a.volume=this.addDevData.volume,a.version=this.addDevData.version,a.id=this.addDevData.id),Object(r.a)({url:e,method:"POST",data:a}).then(function(e){200===e.code?(t.adding=!1,t.addModal=!1,t.$Message.success("成功"),t.addDevData={pole_id:t.$route.query.id,typ:null,name:null,status:1,sn:null,volume:null,version:null,url:null},t.getdevList()):t.adding=!1})},add:function(){this.addModal=!0,this.addText="添加设备",this.addDevData={pole_id:this.$route.query.id,typ:null,name:null,status:1,sn:null,volume:null,version:null,url:null}},cancel:function(){this.addDevData={streetId:this.$route.query.id},this.addModal=!1,this.addDevData={pole_id:this.$route.query.id,typ:null,name:null,status:1,sn:null,volume:null,version:null,url:null}},getdevList:function(){var t=this;this.tableLoading=!0,Object(r.a)({url:"devices/list",method:"POST",data:this.devSearchParams}).then(function(e){t.tableLoading=!1,200===e.code&&(t.devList=e.data.content)})}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("p",{staticStyle:{"line-height":"38px","font-size":"16px"}},[t._v("灯杆：【"+t._s(t.$route.query.streetName)+"】-【"+t._s(t.$route.query.name)+"】")]),t._v(" "),a("div",{staticClass:"search"},["addr_admin"!==t.roleType?a("Button",{staticStyle:{height:"32px","margin-left":"10px"},attrs:{type:"success"},on:{click:t.add}},[t._v("添加设备")]):t._e()],1),t._v(" "),a("Modal",{attrs:{width:"360"},model:{value:t.addModal,callback:function(e){t.addModal=e},expression:"addModal"}},[a("p",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.addText))])]),t._v(" "),a("div",{staticStyle:{"min-height":"350px",overflow:"auto"}},[a("my-form",{ref:"addForm",attrs:{formItems:t.addDevItem,formData:t.addDevData,formRule:t.addDevFormRule},on:{validaok:t.addOk}})],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",size:"large",loading:t.adding},on:{click:function(e){t.doValida("addForm")}}},[t._v("提交")]),t._v(" "),a("Button",{attrs:{type:"default",size:"large"},on:{click:t.cancel}},[t._v("取消")])],1)]),t._v(" "),a("Table",{staticClass:"table",attrs:{loading:t.tableLoading,border:"",columns:t.columns,data:t.devList}})],1)},staticRenderFns:[]};var v=a("VU/8")(u,c,!1,function(t){a("xeGi")},"data-v-8630f442",null);e.default=v.exports},xeGi:function(t,e){}});